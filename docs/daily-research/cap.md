## Intro
capability是一个对象引用(Object References, like the rust reference)；在这个意义上，它类似于一个指针（capability的实现通常被称为 "胖指针"）。它们是不可改变的指针，在这个意义上，一个capability将始终引用同一个对象，所以每个capability都唯一地指定一个特定的对象。

除了指针之外，capability还对访问权限进行编码，事实上，capability是对对象引用和它传递给该对象的权限的封装。在基于capability的系统中，如seL4，调用capability是对系统对象进行操作的唯一方式。

例如，操作可以是调用一个组件中的一个函数。然后，嵌入在capability中的对象引用指向该对象的接口，并传递调用该函数的权利（即组件对象上的特定方法）。该capability可以或不可以同时传递另一个capability作为函数参数的权利（将使用capability参数引用的对象的权利委托给组件）。

正是这种细颗粒度(fine-grained)、面向对象的性质，使得capability成为面向安全的系统的首选访问控制机制。按照最低特权原则的要求，可以将赋予一个组件的权利限制在其完成工作所需的绝对最低限度。

请注意，这个对象capability的概念与 Linux 所谓的 "capability "是完全不同的（而且比 "capability "强大得多），"capability "实际上是具有系统调用粒度的访问控制列表（ACL）。Linuxcapability，就像所有的ACL方案一样，受到Confused deputy problem的困扰，这是许多安全漏洞的根源，下一节会解释。

seL4capability也不容易受到Boebert[1984]的攻击；这种攻击适用于直接在硬件中实现的capability，而seL4的capability是由内核实现和保护的。(可以用来吹capability的[paper](https://csrc.nist.gov/CSRC/media/Publications/conference-paper/1984/09/24/7th-dod-nbs-computer-security-conference/documents/1984-7th-conference-proceedings.pdf))

有十种kernel object
略
## Why Cap
### 精细的访问控制
如上所述，capability提供了细粒度的访问控制，符合最小权限的安全原则（也叫最小权限原则，简称POLA）.这与比较传统的访问控制模型访问控制列表（ACL）形成了鲜明的对比，这种访问控制模型不仅在主流系统如Linux或Windows中使用，而且在商业化的所谓安全系统中也使用，如INTEGRITY或PikeOS。

要了解两者的区别，请考虑Linux中的访问控制是如何工作的。一个文件（文件模型适用于大多数其他Linux对象）有一组相关的访问模式位。其中一些位决定了它的所有者可以在文件上执行什么操作，其他位代表了文件 "组 "的每个成员所允许的操作，最后一组给了其他所有人默认的权利。这是一个面向主体的方案：决定访问有效性的是主体（试图访问的进程）的一个属性，所有具有相同属性值（用户ID或组ID）的主体拥有相同的权利。而且，这些主体对具有相同设置的访问属性的所有文件具有相同的权限。

> Linux 101: in terminal, ``ls -la`` any directory to see the bits

这是一种非常粗粒度的访问控制形式，也是对安全策略的基本限制。一个典型的场景是，用户希望运行一个不受信任的程序（从互联网上下载的）来处理一个特定的文件，但又想阻止该程序访问用户可以访问的任何其他文件。这就是所谓的禁锢场景，而在Linux中并没有干净的方法可以做到这一点，这也是人们想出了重量级的变通方法（我喜欢称之为黑客）的原因，比如 "chroot jails"、容器等。

有了capability，这个问题就很容易解决，因为capability提供了一种面向对象的访问控制形式。具体来说，如果且仅当请求操作的主体呈现出授权其执行操作的capability时，内核才会允许操作进行。在限制场景中，不受信任的应用程序只能访问它被赋予capability的文件。所以Alice调用程序，将一个capability交给程序允许读取的一个文件，再加上一个capability交给程序可以写入输出的文件，程序就无法访问其他任何东西--适当的最小权限。

## Interposition and delegation
capability有进一步的好的特性。其一是能够插入(interpose)访问，这是由于它们是不透明的对象引用的结果。如果Alice被赋予一个对象的capability，她无法知道这个对象到底是什么，她能做的就是调用对象上的方法。

例如，系统设计者可以假装给Alice的capability指的是一个文件，但实际上它指的是一个通往安全监控器的通信通道，而安全监控器又拥有实际的文件capability。监控器可以检查Alice请求的操作，如果有效，就代表她在文件上执行这些操作，而忽略无效的操作。监控器有效地虚拟了文件。

Interposition的应用不仅仅是强制执行安全策略，这种方法还可以用于数据包过滤、信息流跟踪等。调试器可以透明地插入和虚拟对象调用。它甚至可以用来懒惰地创建对象。Alice被赋予了一个构造函数的capability 而不是一个对象引用，一旦对象被创建，构造函数就会替换这个capability。

的另一个优点是它们支持安全而高效的权限授权(delegation)。如果Alice想让Bob访问她的一个对象，她可以为这个对象创建一个新的（在seL4中叫作"mint"），并把它交给Bob。然后Bob就可以使用这个对对象进行操作，而不需要回到Alice那里。(如果，Alice想留在循环中，它可以使用上面解释的虚拟化)。

新的可以有减弱的权限，Alice可以利用这一点给Bob对文件只有readonly的访问权。而Alice可以在任何时候通过销毁她交给Bob的来撤销Bob的访问。

委托的功能很强大，在ACL系统中不能轻易安全地完成。其使用的典型案例是建立自主管理资源的子系统。当系统启动时，初始进程拥有系统中所有资源的权限（除了内核自己使用的少量固定资源外）。这个初始的资源管理器可以通过创建新的进程（二级资源管理器），并将系统资源的不同子集的权限交给它们，从而对系统进行分区。

然后，这些子系统可以自主地（不需要回到最初的管理器）控制它们的资源子集，同时又不能相互干扰。只有当他们想改变原来的资源分配时，才需要让原来的管理者参与进来。

ACL有一个无法解决的问题，一般叫confused deputy problem。我们来看一个C编译器。它接收一个C源文件，并生成一个对象代码输出文件，文件名作为参数传递。要运行编译器，用户Alice必须拥有编译器的执行权限，如图4.2所示。

假设编译器还在系统范围内的日志文件中创建了一个条目，用于审计目的。日志文件是普通用户无法访问的，所以编译器必须用提升的权限来执行，才能写入日志文件（传统的做法是把它变成一个setuid程序）。

如果Alice是恶意的，她可以欺骗编译器做一些不该做的事情。例如，Alice可以在调用编译器时指定密码文件作为输出文件。编译器，除非它被非常小心地编写以避免任何潜在的滥用，否则它就会打开输出文件（密码文件），并将其与编译后的对象代码一起覆盖。

这里的根本问题是，基于ACL的系统使用环境权限(ambient authority)来确定访问权限。当编译器打开其输出文件进行写入时，操作系统通过查看编译器的主体ID来确定访问的有效性，以确定它是否对对象有访问权。由编译器来判断操作是否有效，使得编译器成为系统TCB的一部分，也就是说必须完全信任它，在任何情况下都要做正确的事情。

基于ACL的系统可以采用一些变通方法来缓解这里的特殊问题，例如，确保密码文件和日志文件在不同的安全域中（这并不能阻止Alice对日志文件的破坏，这本身对攻击者掩盖她的痕迹就是一件有用的事情）。然后，这就设置了通常的攻击和变通方法的军备竞赛，这对好人来说总是一个失败的命题。

混乱是由于环境权限而产生的。一个操作的有效性是由代理（编译器）的安全状态决定的 在这种情况下，代理（编译器）是代表原始代理（爱丽丝）操作的副手。为了保证适当的安全性，访问必须由Alice的安全状态决定。这意味着denomination(对文件的引用)和authority(对文件进行操作的权利)必须耦合，这个原则叫做``无指定无授权（no designation without authority）``。如果是这样，那么编译器就会用指定（来自Alice）带来的权限来调用指定对象（输出文件），Alice就不能再迷惑副手了。

这正是系统所执行的。在这样的系统中，Alice需要拥有三种：编译器上的执行，input文件上的读，输出文件上的写。她用执行调用编译器，并将另外两个作为参数传递给编译器。当编译器打开输出文件时，它用Alice提供的来打开，这样就不可能有更多的混乱。编译器使用自己持有的单独的来打开日志文件，使两个文件保持良好的分离。特别是，Alice不可能欺骗编译器向一个她自己没有权限的文件写入。

混乱的副手问题是的 "杀手锏"，因为这个问题用ACL是无法解决的。因此，下次有人想向你推销一个 "安全 "的操作系统时，不仅要问他们是否有这个操作系统的正确性证明，还要问它是否使用了基于的访问控制。如果这两个问题的答案都是 "不是"，那么你就是在向你推销蛇油。

## refs & further reading
1. [ACLs don't](http://waterken.sourceforge.net/aclsdont/current.pdf) : 大概diss了一下普通的ACL还有吹了一下Capability(好耶!)